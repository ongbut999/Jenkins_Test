/*
 * Os_CPUUtilization.c
 *
 *  Created on: Sep 23, 2019
 *      Author: AGT1HC
 */




#include "Os_CPUUtilization.h"
/*==================================================================================================
*                                        LOCAL MACROS
==================================================================================================*/

/*==================================================================================================
*                                      FILE VERSION CHECKS
==================================================================================================*/

/*==================================================================================================
*                          LOCAL TYPEDEFS (STRUCTURES, UNIONS, ENUMS)
==================================================================================================*/

/*==================================================================================================
*                                       LOCAL CONSTANTS
==================================================================================================*/


/*==================================================================================================
*                                       LOCAL VARIABLES
==================================================================================================*/

/*==================================================================================================
*                                       GLOBAL CONSTANTS
==================================================================================================*/


/*==================================================================================================
*                                       GLOBAL VARIABLES
==================================================================================================*/

/*==================================================================================================
*                                   LOCAL FUNCTION PROTOTYPES
==================================================================================================*/


/*==================================================================================================
*                                       LOCAL FUNCTIONS
==================================================================================================*/


/*==================================================================================================
*                                       GLOBAL FUNCTIONS
==================================================================================================*/

#ifdef OS_TIME_MONITORING

double CPU_Utilization(uint32 ms)
{
    static uint32 preTotalTick;
    uint32 curTotalTick;
	double PercentOfUtilizationPerSecond;
	uint32 TotalTick_f;
	Os_StopwatchTickType IdleTick_ul;
	IdleTick_ul = (uint32)IdleTick();
	/*calculate the total ticks */
	curTotalTick  = (uint32)Os_Cbk_GetStopwatch();
	TotalTick_f = curTotalTick - preTotalTick;
	PercentOfUtilizationPerSecond= (double)((double)(TotalTick_f -IdleTick_ul)/TotalTick_f);
	preTotalTick = curTotalTick;
	return PercentOfUtilizationPerSecond;
}

Os_StopwatchTickType IdleTick(void)
{
	Os_StopwatchTickType Idle_Time;

	Idle_Time = Os_GetIdleElapsedTime(OS_CORE_CURRENT);
	Os_ResetIdleElapsedTime(OS_CORE_CURRENT);
	return Idle_Time;
}


#endif /* OS_TIME_MONITORING */
